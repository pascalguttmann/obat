* D:\240318_HFU_SMA_scientific-project\obat\docs\workspace\pss\sim_bias+outstage_ac.asc
V1 N001 0 10
V2 N004 0 -5
V3 in 0 0 AC 3 0
XX1 in N001 N004 N002 N003 bias
XX2 N001 N004 N002 N003 sim_out outstage
E1 model_out 0 in 0 Laplace={w}/(s+{w})

* block symbol definitions
.subckt bias V_IN V_SUP+ V_SUP- V_OUT+ V_OUT-
XX1 N002 V_IN rubber_diode
XX2 V_SUP+ V_SUP- N002 current_source_highside
R1 V_IN V_SUP- 270
Q3 V_SUP+ N001 V_OUT+ 0 TIP41C
Q4 V_SUP- N003 V_OUT- 0 TIP42C
XX3 V_SUP+ V_SUP- N001 current_source_highside
XX4 V_SUP+ V_SUP- N003 current_source_lowside
Q2 V_SUP+ V_IN N003 0 DI_DNLS350E
Q1 V_SUP- N002 N001 0 DI_DPLS350E
.MODEL DI_DNLS350E  NPN (IS=11.7f NF=1.00 BF=388 VAF=127
+ IKF=2.97 ISE=8.95f NE=2.00 BR=4.00 NR=1.00
+ VAR=20.0 IKR=4.50 RE=23.8m RB=95.3m RC=9.53m
+ XTB=1.5 CJE=341p VJE=1.10 MJE=0.500 CJC=45.4p VJC=0.300
+ MJC=0.300 TF=574p TR=111n EG=1.12 )
.MODEL DI_DPLS350E  PNP (IS=9.40f NF=1.00 BF=382 VAF=127
+ IKF=2.48 ISE=8.14f NE=2.00 BR=4.00 NR=1.00
+ VAR=24.0 IKR=3.75 RE=25.8m RB=0.103 RC=10.3m
+ XTB=1.5 CJE=337p VJE=1.10 MJE=0.500 CJC=76.7p VJC=0.300
+ MJC=0.300 TF=645p TR=122n EG=1.12 )
.inc ../std_bjt.lib
.ends bias

.subckt outstage V_SUP+ V_SUP- V_IN+ V_IN- V_OUT
Q1 V_SUP+ N001 N013 0 TIP41C
Q2 V_SUP- N037 N025 0 TIP42C
R1 N013 V_OUT {R_E}
R2 V_OUT N025 {R_E}
Q3 N001 N013 V_OUT 0 DI_DNLS350E
R3 N001 V_IN+ {R_B}
Q4 N037 N025 V_OUT 0 TIP42C
R4 N037 V_IN- {R_B}
Q5 V_SUP+ N002 N014 0 TIP41C
Q6 V_SUP- N038 N026 0 TIP42C
R5 N014 V_OUT {R_E}
R6 V_OUT N026 {R_E}
Q7 N002 N014 V_OUT 0 DI_DNLS350E
R7 N002 V_IN+ {R_B}
Q8 N038 N026 V_OUT 0 TIP42C
R8 N038 V_IN- {R_B}
Q9 V_SUP+ N003 N015 0 TIP41C
Q10 V_SUP- N039 N027 0 TIP42C
R9 N015 V_OUT {R_E}
R10 V_OUT N027 {R_E}
Q11 N003 N015 V_OUT 0 DI_DNLS350E
R11 N003 V_IN+ {R_B}
Q12 N039 N027 V_OUT 0 TIP42C
R12 N039 V_IN- {R_B}
Q13 V_SUP+ N004 N016 0 TIP41C
Q14 V_SUP- N040 N028 0 TIP42C
R13 N016 V_OUT {R_E}
R14 V_OUT N028 {R_E}
Q15 N004 N016 V_OUT 0 DI_DNLS350E
R15 N004 V_IN+ {R_B}
Q16 N040 N028 V_OUT 0 TIP42C
R16 N040 V_IN- {R_B}
Q17 V_SUP+ N005 N017 0 TIP41C
Q18 V_SUP- N041 N029 0 TIP42C
R17 N017 V_OUT {R_E}
R18 V_OUT N029 {R_E}
Q19 N005 N017 V_OUT 0 DI_DNLS350E
R19 N005 V_IN+ {R_B}
Q20 N041 N029 V_OUT 0 TIP42C
R20 N041 V_IN- {R_B}
Q21 V_SUP+ N006 N018 0 TIP41C
Q22 V_SUP- N042 N030 0 TIP42C
R21 N018 V_OUT {R_E}
R22 V_OUT N030 {R_E}
Q23 N006 N018 V_OUT 0 DI_DNLS350E
R23 N006 V_IN+ {R_B}
Q24 N042 N030 V_OUT 0 TIP42C
R24 N042 V_IN- {R_B}
Q25 V_SUP+ N007 N019 0 TIP41C
Q26 V_SUP- N043 N031 0 TIP42C
R25 N019 V_OUT {R_E}
R26 V_OUT N031 {R_E}
Q27 N007 N019 V_OUT 0 DI_DNLS350E
R27 N007 V_IN+ {R_B}
Q28 N043 N031 V_OUT 0 TIP42C
R28 N043 V_IN- {R_B}
Q29 V_SUP+ N008 N020 0 TIP41C
Q30 V_SUP- N044 N032 0 TIP42C
R29 N020 V_OUT {R_E}
R30 V_OUT N032 {R_E}
Q31 N008 N020 V_OUT 0 DI_DNLS350E
R31 N008 V_IN+ {R_B}
Q32 N044 N032 V_OUT 0 TIP42C
R32 N044 V_IN- {R_B}
Q33 V_SUP+ N009 N021 0 TIP41C
Q34 V_SUP- N045 N033 0 TIP42C
R33 N021 V_OUT {R_E}
R34 V_OUT N033 {R_E}
Q35 N009 N021 V_OUT 0 DI_DNLS350E
R35 N009 V_IN+ {R_B}
Q36 N045 N033 V_OUT 0 TIP42C
R36 N045 V_IN- {R_B}
Q37 V_SUP+ N010 N022 0 TIP41C
Q38 V_SUP- N046 N034 0 TIP42C
R37 N022 V_OUT {R_E}
R38 V_OUT N034 {R_E}
Q39 N010 N022 V_OUT 0 DI_DNLS350E
R39 N010 V_IN+ {R_B}
Q40 N046 N034 V_OUT 0 TIP42C
R40 N046 V_IN- {R_B}
Q41 V_SUP+ N011 N023 0 TIP41C
Q42 V_SUP- N047 N035 0 TIP42C
R41 N023 V_OUT {R_E}
R42 V_OUT N035 {R_E}
Q43 N011 N023 V_OUT 0 DI_DNLS350E
R43 N011 V_IN+ {R_B}
Q44 N047 N035 V_OUT 0 TIP42C
R44 N047 V_IN- {R_B}
Q45 V_SUP+ N012 N024 0 TIP41C
Q46 V_SUP- N048 N036 0 TIP42C
R45 N024 V_OUT {R_E}
R46 V_OUT N036 {R_E}
Q47 N012 N024 V_OUT 0 DI_DNLS350E
R47 N012 V_IN+ {R_B}
Q48 N048 N036 V_OUT 0 TIP42C
R48 N048 V_IN- {R_B}
.inc ../std_bjt.lib
.param R_E={680m/2} R_B=22
.MODEL DI_DNLS350E  NPN (IS=11.7f NF=1.00 BF=388 VAF=127
+ IKF=2.97 ISE=8.95f NE=2.00 BR=4.00 NR=1.00
+ VAR=20.0 IKR=4.50 RE=23.8m RB=95.3m RC=9.53m
+ XTB=1.5 CJE=341p VJE=1.10 MJE=0.500 CJC=45.4p VJC=0.300
+ MJC=0.300 TF=574p TR=111n EG=1.12 )
.MODEL DI_DPLS350E  PNP (IS=9.40f NF=1.00 BF=382 VAF=127
+ IKF=2.48 ISE=8.14f NE=2.00 BR=4.00 NR=1.00
+ VAR=24.0 IKR=3.75 RE=25.8m RB=0.103 RC=10.3m
+ XTB=1.5 CJE=337p VJE=1.10 MJE=0.500 CJC=76.7p VJC=0.300
+ MJC=0.300 TF=645p TR=122n EG=1.12 )
.ends outstage

.subckt rubber_diode A K
Q1 A B K 0 DI_DNLS350E
R1 A B 100
R2 B N001 {1k*p}
R3 N001 K 68
.MODEL DI_DNLS350E  NPN (IS=11.7f NF=1.00 BF=388 VAF=127
+ IKF=2.97 ISE=8.95f NE=2.00 BR=4.00 NR=1.00
+ VAR=20.0 IKR=4.50 RE=23.8m RB=95.3m RC=9.53m
+ XTB=1.5 CJE=341p VJE=1.10 MJE=0.500 CJC=45.4p VJC=0.300
+ MJC=0.300 TF=574p TR=111n EG=1.12 )
.MODEL DI_DPLS350E  PNP (IS=9.40f NF=1.00 BF=382 VAF=127
+ IKF=2.48 ISE=8.14f NE=2.00 BR=4.00 NR=1.00
+ VAR=24.0 IKR=3.75 RE=25.8m RB=0.103 RC=10.3m
+ XTB=1.5 CJE=337p VJE=1.10 MJE=0.500 CJC=76.7p VJC=0.300
+ MJC=0.300 TF=645p TR=122n EG=1.12 )
.param p=0.8
.ends rubber_diode

.subckt current_source_highside V_SUP+ V_SUP- I_OUT
R1 V_SUP+ B 1k2
R2 B V_SUP- 8k2
R3 V_SUP+ C 33
Q§DI_DPLS350E I_OUT B C 0 PNP
.MODEL DI_DNLS350E  NPN (IS=11.7f NF=1.00 BF=388 VAF=127
+ IKF=2.97 ISE=8.95f NE=2.00 BR=4.00 NR=1.00
+ VAR=20.0 IKR=4.50 RE=23.8m RB=95.3m RC=9.53m
+ XTB=1.5 CJE=341p VJE=1.10 MJE=0.500 CJC=45.4p VJC=0.300
+ MJC=0.300 TF=574p TR=111n EG=1.12 )
.MODEL DI_DPLS350E  PNP (IS=9.40f NF=1.00 BF=382 VAF=127
+ IKF=2.48 ISE=8.14f NE=2.00 BR=4.00 NR=1.00
+ VAR=24.0 IKR=3.75 RE=25.8m RB=0.103 RC=10.3m
+ XTB=1.5 CJE=337p VJE=1.10 MJE=0.500 CJC=76.7p VJC=0.300
+ MJC=0.300 TF=645p TR=122n EG=1.12 )
.ends current_source_highside

.subckt current_source_lowside V_SUP+ V_SUP- I_IN
Q1 I_IN B E 0 DI_DNLS350E
R1 V_SUP+ B 8k2
R2 B V_SUP- 1k
R3 E V_SUP- 33
.MODEL DI_DNLS350E  NPN (IS=11.7f NF=1.00 BF=388 VAF=127
+ IKF=2.97 ISE=8.95f NE=2.00 BR=4.00 NR=1.00
+ VAR=20.0 IKR=4.50 RE=23.8m RB=95.3m RC=9.53m
+ XTB=1.5 CJE=341p VJE=1.10 MJE=0.500 CJC=45.4p VJC=0.300
+ MJC=0.300 TF=574p TR=111n EG=1.12 )
.MODEL DI_DPLS350E  PNP (IS=9.40f NF=1.00 BF=382 VAF=127
+ IKF=2.48 ISE=8.14f NE=2.00 BR=4.00 NR=1.00
+ VAR=24.0 IKR=3.75 RE=25.8m RB=0.103 RC=10.3m
+ XTB=1.5 CJE=337p VJE=1.10 MJE=0.500 CJC=76.7p VJC=0.300
+ MJC=0.300 TF=645p TR=122n EG=1.12 )
.ends current_source_lowside

.model NPN NPN
.model PNP PNP
.lib C:\Users\Pascal_Guttmann\AppData\Local\LTspice\lib\cmp\standard.bjt
.ac dec 100 1 1T
.param w={2*pi*f} f=10Meg
.backanno
.end
